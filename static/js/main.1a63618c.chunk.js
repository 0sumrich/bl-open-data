(this["webpackJsonpbl-open-data"]=this["webpackJsonpbl-open-data"]||[]).push([[0],{120:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n(0),c=n.n(a),i=n(19),o=n.n(i),s=n(160),u=n(159),l=n(21),f=n(6),p=n.n(f),h=n(14),d=n(9),j=n(158),b=n(52),x=n(147),m=Object(x.a)((function(t){return{root:{width:"100%",display:"block",margin:"auto",paddingTop:t.spacing(3),textAlign:"center"}}})),O=function(t){var e=t.siteTitle,n=t.subTitle,a=m();return Object(r.jsxs)("header",{className:a.root,children:[Object(r.jsx)(b.a,{variant:"h2",component:"h1",children:e}),Object(r.jsx)(b.a,{variant:"h4",component:"h4",children:n})]})},v=n(163),y=n(152),g=n(164),k=n(150),T=n(151),w=n(17),L=function(t){return t.replace(/\s+/g,"-").toLowerCase()},S=function(t,e){return t[t.map((function(t){return t.title})).indexOf(e)]},A=function(t){return[Object(k.a)(t),Object(T.a)(t)]},M=n(75),C=n.n(M),N=Object(x.a)((function(t){return{root:{position:"fixed",paddingLeft:t.spacing(1),marginTop:t.spacing(3)},link:{color:t.palette.text.primary,"&:hover":{color:t.palette.text.secondary,borderLeft:"1px solid ".concat(t.palette.secondary.main)}},active:{borderLeft:"2px solid ".concat(t.palette.secondary.main)}}}));function F(t){return Object(r.jsx)(g.a,{smDown:!0,children:Object(r.jsx)(v.a,Object(l.a)({component:"a",display:"hidden"},t))})}var D=function(t){var e=t.titles,n=N(),a=e.map((function(t){return L(t)}));return Object(r.jsx)(C.a,{items:a,currentClassName:n.active,className:n.root,children:e.map((function(t,e){return Object(r.jsx)(F,{className:n.link,href:"#".concat(a[e]),children:Object(r.jsx)(y.a,{primary:t})},a[e])}))})},z=Object(x.a)((function(t){return{root:{margin:"auto",maxWidth:1126,padding:t.spacing(4)}}}));var E=function(t){var e=t.children,n=z();return Object(r.jsx)("div",{className:n.root,children:e})},I=n(168),J=n(153),B=Object(x.a)((function(t){return{root:{margin:"".concat(t.spacing(2),"px auto"),overflow:"visible"},cardHelper:{padding:t.spacing(3),position:"relative"}}}));var W=function(t){var e=t.children,n=B();return Object(r.jsx)(I.a,{className:n.root,children:Object(r.jsx)(J.a,{className:n.cardHelper,children:e})})},X=n(80),Y=n(20),q=n(57),H=n.n(q),P=n(169),R=n(154);function G(t){return t.forEach((function(t){t.data.forEach((function(t){var e,n=t.Month,r=(e=n,w.DateTime.fromISO(e).plus({months:1,days:-1}).toJSDate());t.Month=r}))})),t}var K=Object(x.a)((function(t){return{tooltip:{display:"inline",marginLeft:function(e){return t.spacing(3)+e.margin.left},marginTop:function(e){return t.spacing(3)+e.margin.top},position:"absolute",left:function(t){return t.left?t.left:"auto"},top:function(t){return t.top},transform:"translate(-50%, -50%)",visibility:function(t){return t.visible?"visible":"hidden"},background:t.palette.grey[900],opacity:.5,color:t.palette.primary.contrastText,borderRadius:t.shape.borderRadius,padding:t.spacing(1)}}}));var Q=function(t){var e=K(t);return Object(r.jsx)("div",{className:e.tooltip,children:t.children})},U=n(155),V=n(161),Z=n(157),$=n(162),_=n(165),tt=n(170),et=n(167),nt=Object(x.a)((function(t){return{xAxis:{fill:"none",fontSize:10,fontFamily:"inherit"},tickTextX:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"middle"},tickTextY:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"end"}}})),rt=function(t){var e=t.height,n=t.width,c=t.tickArray,i=t.scale,o=t.tickFunction,s=nt(),u=i;return Object(r.jsxs)("g",{className:s.xAxis,transform:"translate(0, ".concat(e,")"),children:[Object(r.jsx)("line",{x1:0,x2:n,stroke:"black"}),a.Children.toArray(c.map((function(t){return Object(r.jsx)(r.Fragment,{children:Object(r.jsxs)("g",{transform:"translate(".concat(u(t),", 0)"),children:[Object(r.jsx)("line",{y2:"6",stroke:"currentColor"}),Object(r.jsx)("text",{className:s.tickTextX,y:"9",dy:"0.71em",children:o?o(t):t})]})})})))]})},at=Object(x.a)((function(t){return{xAxis:{fill:"none",fontSize:10,fontFamily:"inherit"},tickTextX:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"middle"},tickTextY:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"end"}}})),ct=function(t){var e=t.height,n=t.tickArray,c=t.scale,i=t.tickFunction,o=at(),s=c;return Object(r.jsxs)("g",{className:o.yAxis,transform:"translate(0, 0)",children:[Object(r.jsx)("line",{y1:0,y2:e,stroke:"black"}),a.Children.toArray(n.map((function(t){return Object(r.jsxs)("g",{transform:"translate(0, ".concat(s(t),")"),children:[Object(r.jsx)("line",{x2:"-6",stroke:"currentColor"}),Object(r.jsx)("text",{className:o.tickTextY,x:"-10",dy:"0.32em",children:i?i(t):t})]})})))]})},it=n(81),ot={alignmentBaseline:"middle",textAnchor:"middle",fontSize:"medium"},st=function(t){var e=t.children,n=Object(it.a)(t,["children"]);return Object(r.jsx)("text",Object(l.a)(Object(l.a)({style:ot},n),{},{children:e}))},ut={select:U.a,scaleLinear:V.a,scaleOrdinal:Z.a,scaleTime:$.a,min:k.a,max:T.a,line:_.a,schemeTableau10:tt.a,axisLeft:et.b,axisBottom:et.a},lt=Object(x.a)((function(t){return{root:{width:"100%",height:"450px"},line:{strokeWidth:1.5,fill:"none",cursor:"pointer","&:hover":{strokeWidth:3}},selected:{strokeWidth:3},circle:{cursor:"pointer"},legend:{fill:"none",fontSize:10},legendText:{fontSize:"0.6rem",stroke:"none",textAnchor:"end"}}}));var ft=function(t){var e=t.data,n=t.title,c="svg-"+L(n),i=Object(a.useState)(G(function(t){var e=(n=t.data,r=["Month","Type","Loans"],n.map((function(t){var e={};return r.forEach((function(n){return e[n]=t[n]})),e})));var n,r;return Array.from(Object(P.a)(e,(function(t){return Object(R.a)(t.map((function(t){return+t.Loans})))}),(function(t){return t.Type}),(function(t){return t.Month})),(function(t){var e=Object(d.a)(t,2),n=e[0],r=e[1];return{Type:n,data:Array.from(r,(function(t){var e=Object(d.a)(t,2);return{Month:e[0],Loans:e[1]}}))}}))}(e))),o=Object(d.a)(i,2),s=o[0],u=(o[1],Object(a.useState)(0)),l=Object(d.a)(u,2),f=l[0],p=l[1],h=Object(a.useState)(450),j=Object(d.a)(h,2),x=j[0],m=j[1],O=Object(a.useState)(x/2),v=Object(d.a)(O,2),y=v[0],g=v[1],k=Object(a.useState)(!1),T=Object(d.a)(k,2),S=T[0],M=T[1],C=Object(a.useState)(""),N=Object(d.a)(C,2),F=N[0],D=N[1],z=Object(a.useState)([f/2,x/2]),E=Object(d.a)(z,2),I=E[0],J=E[1],B=Object(a.useState)(!1),W=Object(d.a)(B,2),q=W[0],K=W[1],U=Object(a.useState)({type:"",month:"",loans:""}),V=Object(d.a)(U,2),Z=V[0],$=V[1],_=Object(a.useState)([]),tt=Object(d.a)(_,2),et=tt[0],nt=tt[1],at={top:65,right:10,bottom:30,left:75},it=lt();Object(a.useEffect)((function(){var t=ut.select("#".concat(c));p(parseInt(t.style("width"))-at.left-at.right),m(parseInt(t.style("height"))-at.top-at.bottom)}));var ot=s.map((function(t){return t.data.map((function(t){return t.Month}))}))[0],ft=s.map((function(t){return t.data.map((function(t){return t.Loans}))})).flat(),pt=ut.scaleTime().domain(A(ot)).range([0,f]),ht=ut.scaleLinear().domain(A(ft)).range([x,0]),dt=ut.line().x((function(t){return pt(t.Month)})).y((function(t){return ht(t.Loans)})),jt=ut.scaleOrdinal().domain(s.map((function(t){return t.Type}))).range(ut.schemeTableau10);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("svg",{onDoubleClick:function(){return nt([])},className:it.root,id:c,width:f+at.left+at.right,height:x+at.top+at.bottom,children:[Object(r.jsx)(st,{x:at.left+f/2,y:.25*at.top,children:n}),Object(r.jsxs)("g",{style:{transform:"translate(".concat(at.left,"px, ").concat(at.top,"px)")},children:[Object(r.jsxs)("g",{children:[a.Children.toArray(s.map((function(t){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("path",{className:H()(it.line,Object(Y.a)({},it.selected,et.includes(t.Type))),stroke:jt(t.Type),d:dt(t.data),onMouseEnter:function(){g(ht(function(t){var e=t.map((function(t){return t.Month}));if(t.length%2===0)return t[e.length/2].Loans;var n=Math.floor(e.length/2);return(t[n].Loans+t[n+1].Loans)/2}(t.data))),M(!0),D(t.Type)},onMouseLeave:function(){M(!1)},onClick:function(){et.includes(t.Type)?nt(et.filter((function(e){return e!==t.Type}))):nt([].concat(Object(X.a)(et),[t.Type]))},strokeOpacity:et.includes(t.Type)||et.length<1?1:.2}),Object(r.jsx)("g",{children:a.Children.toArray(t.data.map((function(e){return Object(r.jsx)("circle",{className:it.circle,r:1.5,cx:pt(e.Month),cy:ht(e.Loans),fill:jt(t.Type),onMouseEnter:function(n){n.currentTarget.setAttribute("r",3),J([pt(e.Month),ht(e.Loans)]),K(!0),$({type:t.Type,month:e.Month,loans:e.Loans})},onMouseLeave:function(t){t.currentTarget.setAttribute("r",1.5),K(!1)}})})))})]})}))),Object(r.jsx)("g",{className:it.legend,transform:"translate(".concat(f,", 0)"),children:a.Children.toArray(et.map((function(t,e){return Object(r.jsx)("text",{className:it.legendText,y:15*e,fill:jt(t),children:t})})))})]}),Object(r.jsx)(rt,{height:x,width:f,tickArray:ot,tickFunction:function(t){return w.DateTime.fromJSDate(t).toFormat("MMM yy")},scale:pt}),Object(r.jsx)(ct,{height:x,width:f,tickArray:ht.ticks(),scale:ht}),Object(r.jsx)("text",{transform:"rotate(-90)",x:x/-2,y:-at.left,dy:"1rem",style:{textAnchor:"middle"},children:"Loans + renewals"})]})]}),Object(r.jsx)(Q,{margin:at,top:y-25,left:f/2,visible:S,children:Object(r.jsx)(b.a,{variant:"caption",children:F})}),Object(r.jsx)(Q,{margin:at,left:I[0],top:I[1]-45,visible:q,children:Object(r.jsxs)(b.a,{variant:"caption",children:["".concat(Z.type),Object(r.jsx)("br",{}),"".concat(w.DateTime.fromJSDate(Z.month).toFormat("MMM y")),Object(r.jsx)("br",{}),"Loans: ".concat(Z.loans)]})})]})},pt=n(5),ht=n(59),dt=function(){var t=Object(h.a)(p.a.mark((function t(e){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e).then((function(t){return t.text()})).then((function(t){return Object(ht.a)(t)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),jt=function(){var t=Object(h.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,dt("".concat("/bl-open-data","/datasets.csv"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),bt=function(t){var e,n,r;return n="api/",r="https://open.barnet.gov.uk/".length,"".concat((e=t).slice(0,r)).concat(n).concat(e.slice(r))},xt={headers:{Origin:"/bl-open-data"}},mt=function(){var t=Object(h.a)(p.a.mark((function t(e){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors-anywhere.herokuapp.com/"+e,xt);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function Ot(t){return vt.apply(this,arguments)}function vt(){return(vt=Object(h.a)(p.a.mark((function t(e){var n,r,a,c,i,o,s,u,l,f,h,d;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,mt(bt(e));case 3:return n=t.sent,t.next=6,n.json();case 6:for(r=t.sent,a=r.resources,c=[],i=[],o=0,s=Object.keys(a);o<s.length;o++)u=s[o],l=a[u],f=w.DateTime.fromISO(l.qa.timestamp.slice(0,"yyyy-mm-dd".length)),i.push(f),c.push(u);return h=c[i.indexOf(w.DateTime.max.apply(w.DateTime,i))],d=a[h].url,t.abrupt("return",d);case 16:return t.prev=16,t.t0=t.catch(0),console.log(t.t0),t.abrupt("return",void 0);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function yt(){return gt.apply(this,arguments)}function gt(){return(gt=Object(h.a)(p.a.mark((function t(){var e,n,r,a,c,i,o,s,u;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,jt();case 2:e=t.sent,n=[],r=Object(pt.a)(e),t.prev=5,r.s();case 7:if((a=r.n()).done){t.next=31;break}return c=a.value,i=c.url,t.next=12,Ot(i);case 12:return o=t.sent,t.prev=13,t.next=16,mt(o);case 16:return s=t.sent,t.next=19,s.text().then((function(t){return Object(ht.a)(t)}));case 19:u=t.sent,c.data=u,n.push(c),t.next=29;break;case 24:return t.prev=24,t.t0=t.catch(13),console.log(t.t0),n.push(void 0),t.abrupt("continue",29);case 29:t.next=7;break;case 31:t.next=36;break;case 33:t.prev=33,t.t1=t.catch(5),r.e(t.t1);case 36:return t.prev=36,r.f(),t.finish(36);case 39:return t.abrupt("return",n);case 40:case"end":return t.stop()}}),t,null,[[5,33,36,39],[13,24]])})))).apply(this,arguments)}function kt(){return Tt.apply(this,arguments)}function Tt(){return(Tt=Object(h.a)(p.a.mark((function t(){var e,n,r,a,c,i,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,jt();case 2:e=t.sent,n=[],r=Object(pt.a)(e),t.prev=5,r.s();case 7:if((a=r.n()).done){t.next=17;break}return c=a.value,i=c.title,t.next=12,dt("".concat("/bl-open-data","/data/").concat(i,".csv"));case 12:o=t.sent,c.data=o,n.push(c);case 15:t.next=7;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(5),r.e(t.t0);case 22:return t.prev=22,r.f(),t.finish(22);case 25:return t.abrupt("return",n);case 26:case"end":return t.stop()}}),t,null,[[5,19,22,25]])})))).apply(this,arguments)}function wt(){return(wt=Object(h.a)(p.a.mark((function t(e){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,kt();case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,yt();case 8:t.t0=t.sent;case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Lt=function(t){return wt.apply(this,arguments)},St=function(t){var e=t.children;return Object(r.jsx)(j.a,{item:!0,md:2,sm:!1,xs:!1,children:e})},At=function(t){var e=t.children;return Object(r.jsx)(j.a,{item:!0,md:10,sm:12,xs:12,children:e})};var Mt=function(){var t=Object(a.useState)([]),e=Object(d.a)(t,2),n=e[0],c=e[1];Object(a.useEffect)((function(){(function(){var t=Object(h.a)(p.a.mark((function t(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Lt(false);case 2:e=t.sent,c(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]);var i=[{title:"Loans by item type",component:function(t){return Object(r.jsx)(ft,Object(l.a)(Object(l.a)({},t),{},{data:S(n,"Library loans")}))}}];return Object(r.jsxs)(j.a,{container:!0,children:[Object(r.jsx)(St,{children:Object(r.jsx)(D,{titles:i.map((function(t){return t.title}))})}),Object(r.jsxs)(At,{children:[Object(r.jsx)(O,{siteTitle:"Barnet Libraries",subTitle:"Open data"}),Object(r.jsx)(E,{children:a.Children.toArray(i.map((function(t,e){var a=t.title,c=t.component;return Object(r.jsx)("section",{id:L(a),children:Object(r.jsx)(W,{children:n.length>0?c({title:a}):null})})})))})]})]})},Ct=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,172)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),r(t),a(t),c(t),i(t)}))},Nt=n(79),Ft=Object(Nt.a)({});o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsxs)(u.a,{theme:Ft,children:[Object(r.jsx)(s.a,{}),Object(r.jsx)(Mt,{})]})}),document.querySelector("#root")),Ct()}},[[120,1,2]]]);
//# sourceMappingURL=main.1a63618c.chunk.js.map