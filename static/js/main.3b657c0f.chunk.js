(this["webpackJsonpbl-open-data"]=this["webpackJsonpbl-open-data"]||[]).push([[0],{120:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n(0),c=n.n(a),i=n(21),o=n.n(i),s=n(160),u=n(159),l=n(15),f=n(6),b=n.n(f),j=n(16),h=n(11),p=n(158),d=n(52),x=n(147),m=Object(x.a)((function(t){return{root:{width:"100%",display:"block",margin:"auto",paddingTop:t.spacing(3),textAlign:"center"}}})),O=function(t){var e=t.siteTitle,n=t.subTitle,a=m();return Object(r.jsxs)("header",{className:a.root,children:[Object(r.jsx)(d.a,{variant:"h2",component:"h1",children:e}),Object(r.jsx)(d.a,{variant:"h4",component:"h4",children:n})]})},v=n(163),y=n(152),g=n(164),k=n(150),L=n(151),T=n(19),w=function(t){return t.replace(/\s+/g,"-").toLowerCase()},S=function(t,e){return t[t.map((function(t){return t.title})).indexOf(e)]},A=function(t){return[Object(k.a)(t),Object(L.a)(t)]},M=n(75),C=n.n(M),N=Object(x.a)((function(t){return{root:{position:"fixed",paddingLeft:t.spacing(1),marginTop:t.spacing(3)},link:{color:t.palette.text.primary,"&:hover":{color:t.palette.text.secondary,borderLeft:"1px solid ".concat(t.palette.secondary.main)}},active:{borderLeft:"2px solid ".concat(t.palette.secondary.main)}}}));function F(t){return Object(r.jsx)(g.a,{smDown:!0,children:Object(r.jsx)(v.a,Object(l.a)({component:"a",display:"hidden"},t))})}var D=function(t){var e=t.titles,n=N(),a=e.map((function(t){return w(t)}));return Object(r.jsx)(C.a,{items:a,currentClassName:n.active,className:n.root,children:e.map((function(t,e){return Object(r.jsx)(F,{className:n.link,href:"#".concat(a[e]),children:Object(r.jsx)(y.a,{primary:t})},a[e])}))})},z=Object(x.a)((function(t){return{root:{margin:"auto",maxWidth:1126,padding:t.spacing(4)}}}));var E=function(t){var e=t.children,n=z();return Object(r.jsx)("div",{className:n.root,children:e})},I=n(168),J=n(153),B=Object(x.a)((function(t){return{root:{margin:"".concat(t.spacing(2),"px auto"),overflow:"visible"},cardHelper:{padding:t.spacing(3),position:"relative"}}}));var W=function(t){var e=t.children,n=B();return Object(r.jsx)(I.a,{className:n.root,children:Object(r.jsx)(J.a,{className:n.cardHelper,children:e})})},X=n(80),Y=n(10),q=n(57),H=n.n(q),P=n(169),R=n(154);function G(t){return t.forEach((function(t){t.data.forEach((function(t){var e,n=t.Month,r=(e=n,T.DateTime.fromISO(e).plus({months:1,days:-1}).toJSDate());t.Month=r}))})),t}function K(t,e){var n=e[0],r=function(t,e){return t.map((function(t){var n={};return e.forEach((function(e){return n[e]=t[e]})),n}))}(t.data,e);return Array.from(Object(P.a)(r,(function(t){return Object(R.a)(t.map((function(t){return+t.Loans})))}),(function(t){return t[n]}),(function(t){return t.Month})),(function(t){var e,r=Object(h.a)(t,2),a=r[0],c=r[1];return e={},Object(Y.a)(e,n,a),Object(Y.a)(e,"data",Array.from(c,(function(t){var e=Object(h.a)(t,2);return{Month:e[0],Loans:e[1]}}))),e}))}var Q=Object(x.a)((function(t){return{tooltip:{display:"inline",marginLeft:function(e){return t.spacing(3)+e.margin.left},marginTop:function(e){return t.spacing(3)+e.margin.top},position:"absolute",left:function(t){return t.left?t.left:"auto"},top:function(t){return t.top},transform:"translate(-50%, -50%)",visibility:function(t){return t.visible?"visible":"hidden"},background:t.palette.grey[900],opacity:.5,color:t.palette.primary.contrastText,borderRadius:t.shape.borderRadius,padding:t.spacing(1)}}}));var U=function(t){var e=Q(t);return Object(r.jsx)("div",{className:e.tooltip,children:t.children})},V=n(155),Z=n(161),$=n(157),_=n(162),tt=n(165),et=n(170),nt=n(167),rt=Object(x.a)((function(t){return{xAxis:{fill:"none",fontSize:10,fontFamily:"inherit"},tickTextX:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"middle"},tickTextY:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"end"}}})),at=function(t){var e=t.height,n=t.width,c=t.tickArray,i=t.scale,o=t.tickFunction,s=rt(),u=i;return Object(r.jsxs)("g",{className:s.xAxis,transform:"translate(0, ".concat(e,")"),children:[Object(r.jsx)("line",{x1:0,x2:n,stroke:"black"}),a.Children.toArray(c.map((function(t){return Object(r.jsx)(r.Fragment,{children:Object(r.jsxs)("g",{transform:"translate(".concat(u(t),", 0)"),children:[Object(r.jsx)("line",{y2:"6",stroke:"currentColor"}),Object(r.jsx)("text",{className:s.tickTextX,y:"9",dy:"0.71em",children:o?o(t):t})]})})})))]})},ct=Object(x.a)((function(t){return{xAxis:{fill:"none",fontSize:10,fontFamily:"inherit"},tickTextX:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"middle"},tickTextY:{fontSize:"0.6rem",stroke:"none",fill:"currentColor",textAnchor:"end"}}})),it=function(t){var e=t.height,n=t.tickArray,c=t.scale,i=t.tickFunction,o=ct(),s=c;return Object(r.jsxs)("g",{className:o.yAxis,transform:"translate(0, 0)",children:[Object(r.jsx)("line",{y1:0,y2:e,stroke:"black"}),a.Children.toArray(n.map((function(t){return Object(r.jsxs)("g",{transform:"translate(0, ".concat(s(t),")"),children:[Object(r.jsx)("line",{x2:"-6",stroke:"currentColor"}),Object(r.jsx)("text",{className:o.tickTextY,x:"-10",dy:"0.32em",children:i?i(t):t})]})})))]})},ot=n(81),st={alignmentBaseline:"middle",textAnchor:"middle",fontSize:"medium"},ut=function(t){var e=t.children,n=Object(ot.a)(t,["children"]);return Object(r.jsx)("text",Object(l.a)(Object(l.a)({style:st},n),{},{children:e}))},lt={select:V.a,scaleLinear:Z.a,scaleOrdinal:$.a,scaleTime:_.a,min:k.a,max:L.a,line:tt.a,schemeTableau10:et.a,axisLeft:nt.b,axisBottom:nt.a},ft=Object(x.a)((function(t){return{root:{width:"100%",height:"450px"},line:{strokeWidth:1.5,fill:"none",cursor:"pointer","&:hover":{strokeWidth:3}},selected:{strokeWidth:3},circle:{cursor:"pointer"},legend:{fill:"none",fontSize:10},legendText:{fontSize:"0.6rem",stroke:"none",textAnchor:"end"}}}));var bt=function(t){var e,n=t.data,c=t.title,i="svg-"+w(c),o=Object.keys(n[0]).filter((function(t){return"data"!==t})),s=Object(a.useState)(0),u=Object(h.a)(s,2),l=u[0],f=u[1],b=Object(a.useState)(450),j=Object(h.a)(b,2),p=j[0],x=j[1],m=Object(a.useState)(p/2),O=Object(h.a)(m,2),v=O[0],y=O[1],g=Object(a.useState)(!1),k=Object(h.a)(g,2),L=k[0],S=k[1],M=Object(a.useState)(""),C=Object(h.a)(M,2),N=C[0],F=C[1],D=Object(a.useState)([l/2,p/2]),z=Object(h.a)(D,2),E=z[0],I=z[1],J=Object(a.useState)(!1),B=Object(h.a)(J,2),W=B[0],q=B[1],P=Object(a.useState)((e={},Object(Y.a)(e,o,""),Object(Y.a)(e,"month",""),Object(Y.a)(e,"loans",""),e)),R=Object(h.a)(P,2),G=R[0],K=R[1],Q=Object(a.useState)([]),V=Object(h.a)(Q,2),Z=V[0],$=V[1],_={top:65,right:60,bottom:30,left:85},tt=ft();Object(a.useEffect)((function(){var t=lt.select("#".concat(i));f(parseInt(t.style("width"))-_.left-_.right),x(parseInt(t.style("height"))-_.top-_.bottom)}));var et=n.map((function(t){return t.data.map((function(t){return t.Month}))}))[0],nt=n.map((function(t){return t.data.map((function(t){return t.Loans}))})).flat(),rt=lt.scaleTime().domain(A(et)).range([0,l]),ct=lt.scaleLinear().domain(A(nt)).range([p,0]),ot=lt.line().x((function(t){return rt(t.Month)})).y((function(t){return ct(t.Loans)})),st=lt.scaleOrdinal().domain(n.map((function(t){return t[o]}))).range(lt.schemeTableau10);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("svg",{onDoubleClick:function(){return $([])},className:tt.root,id:i,width:l+_.left+_.right,height:p+_.top+_.bottom,children:[Object(r.jsx)(ut,{x:_.left+l/2,y:.25*_.top,children:"Monthly "+c}),Object(r.jsxs)("g",{style:{transform:"translate(".concat(_.left,"px, ").concat(_.top,"px)")},children:[Object(r.jsxs)("g",{children:[a.Children.toArray(n.map((function(t){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("path",{className:H()(tt.line,Object(Y.a)({},tt.selected,Z.includes(t[o]))),stroke:st(t[o]),d:ot(t.data),onMouseEnter:function(){y(ct(function(t){var e=t.map((function(t){return t.Month}));if(t.length%2===0)return t[e.length/2].Loans;var n=Math.floor(e.length/2);return(t[n].Loans+t[n+1].Loans)/2}(t.data))),S(!0),F(t[o])},onMouseLeave:function(){S(!1)},onClick:function(){Z.includes(t[o])?$(Z.filter((function(e){return e!==t[o]}))):$([].concat(Object(X.a)(Z),[t[o]]))},strokeOpacity:Z.includes(t[o])||Z.length<1?1:.2}),Object(r.jsx)("g",{children:a.Children.toArray(t.data.map((function(e){return Object(r.jsx)("circle",{className:tt.circle,r:1.5,cx:rt(e.Month),cy:ct(e.Loans),fill:st(t[o]),onMouseEnter:function(n){var r;n.currentTarget.setAttribute("r",3),I([rt(e.Month),ct(e.Loans)]),q(!0),K((r={},Object(Y.a)(r,o,t[o]),Object(Y.a)(r,"month",e.Month),Object(Y.a)(r,"loans",e.Loans),r))},onMouseLeave:function(t){t.currentTarget.setAttribute("r",1.5),q(!1)}})})))})]})}))),Object(r.jsx)("g",{className:tt.legend,transform:"translate(".concat(l,", 0)"),children:a.Children.toArray(Z.map((function(t,e){return Object(r.jsx)("text",{className:tt.legendText,y:15*e,fill:st(t),children:t})})))})]}),Object(r.jsx)(at,{height:p,width:l,tickArray:et,tickFunction:function(t){return T.DateTime.fromJSDate(t).toFormat("MMM yy")},scale:rt}),Object(r.jsx)(it,{height:p,width:l,tickArray:ct.ticks(),scale:ct}),Object(r.jsx)("text",{transform:"rotate(-90)",x:p/-2,y:-_.left,dy:"1rem",style:{textAnchor:"middle"},children:"Loans + renewals"})]})]}),Object(r.jsx)(U,{margin:_,top:v-25,left:l/2,visible:L,children:Object(r.jsx)(d.a,{variant:"caption",children:N})}),Object(r.jsx)(U,{margin:_,left:E[0],top:E[1]-45,visible:W,children:Object(r.jsxs)(d.a,{variant:"caption",children:["".concat(G[o]),Object(r.jsx)("br",{}),"".concat(T.DateTime.fromJSDate(G.month).toFormat("MMM y")),Object(r.jsx)("br",{}),"Loans: ".concat(G.loans)]})})]})},jt=n(5),ht=n(59),pt=function(){var t=Object(j.a)(b.a.mark((function t(e){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e).then((function(t){return t.text()})).then((function(t){return Object(ht.a)(t)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),dt=function(){var t=Object(j.a)(b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,pt("".concat("/bl-open-data","/datasets.csv"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),xt=function(t){var e,n,r;return n="api/",r="https://open.barnet.gov.uk/".length,"".concat((e=t).slice(0,r)).concat(n).concat(e.slice(r))},mt={headers:{Origin:"/bl-open-data"}},Ot=function(){var t=Object(j.a)(b.a.mark((function t(e){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors-anywhere.herokuapp.com/"+e,mt);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function vt(t){return yt.apply(this,arguments)}function yt(){return(yt=Object(j.a)(b.a.mark((function t(e){var n,r,a,c,i,o,s,u,l,f,j,h;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ot(xt(e));case 3:return n=t.sent,t.next=6,n.json();case 6:for(r=t.sent,a=r.resources,c=[],i=[],o=0,s=Object.keys(a);o<s.length;o++)u=s[o],l=a[u],f=T.DateTime.fromISO(l.qa.timestamp.slice(0,"yyyy-mm-dd".length)),i.push(f),c.push(u);return j=c[i.indexOf(T.DateTime.max.apply(T.DateTime,i))],h=a[j].url,t.abrupt("return",h);case 16:return t.prev=16,t.t0=t.catch(0),console.log(t.t0),t.abrupt("return",void 0);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function gt(){return kt.apply(this,arguments)}function kt(){return(kt=Object(j.a)(b.a.mark((function t(){var e,n,r,a,c,i,o,s,u;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,dt();case 2:e=t.sent,n=[],r=Object(jt.a)(e),t.prev=5,r.s();case 7:if((a=r.n()).done){t.next=31;break}return c=a.value,i=c.url,t.next=12,vt(i);case 12:return o=t.sent,t.prev=13,t.next=16,Ot(o);case 16:return s=t.sent,t.next=19,s.text().then((function(t){return Object(ht.a)(t)}));case 19:u=t.sent,c.data=u,n.push(c),t.next=29;break;case 24:return t.prev=24,t.t0=t.catch(13),console.log(t.t0),n.push(void 0),t.abrupt("continue",29);case 29:t.next=7;break;case 31:t.next=36;break;case 33:t.prev=33,t.t1=t.catch(5),r.e(t.t1);case 36:return t.prev=36,r.f(),t.finish(36);case 39:return t.abrupt("return",n);case 40:case"end":return t.stop()}}),t,null,[[5,33,36,39],[13,24]])})))).apply(this,arguments)}function Lt(){return Tt.apply(this,arguments)}function Tt(){return(Tt=Object(j.a)(b.a.mark((function t(){var e,n,r,a,c,i,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,dt();case 2:e=t.sent,n=[],r=Object(jt.a)(e),t.prev=5,r.s();case 7:if((a=r.n()).done){t.next=17;break}return c=a.value,i=c.title,t.next=12,pt("".concat("/bl-open-data","/data/").concat(i,".csv"));case 12:o=t.sent,c.data=o,n.push(c);case 15:t.next=7;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(5),r.e(t.t0);case 22:return t.prev=22,r.f(),t.finish(22);case 25:return t.abrupt("return",n);case 26:case"end":return t.stop()}}),t,null,[[5,19,22,25]])})))).apply(this,arguments)}function wt(){return(wt=Object(j.a)(b.a.mark((function t(e){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,Lt();case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,gt();case 8:t.t0=t.sent;case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var St=function(t){return wt.apply(this,arguments)},At=function(t){var e=t.children;return Object(r.jsx)(p.a,{item:!0,md:2,sm:!1,xs:!1,children:e})},Mt=function(t){var e=t.children;return Object(r.jsx)(p.a,{item:!0,md:10,sm:12,xs:12,children:e})};var Ct=function(){var t=Object(a.useState)([]),e=Object(h.a)(t,2),n=e[0],c=e[1];Object(a.useEffect)((function(){(function(){var t=Object(j.a)(b.a.mark((function t(){var e;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,St(false);case 2:e=t.sent,c(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]);var i=[{title:"Loans by item type",component:function(t){return Object(r.jsx)(bt,Object(l.a)(Object(l.a)({},t),{},{data:(e=S(n,"Library loans"),G(K(e,["Type","Month","Loans"])))}));var e}},{title:"Loans by library",component:function(t){return Object(r.jsx)(bt,Object(l.a)(Object(l.a)({},t),{},{data:(e=S(n,"Library loans"),G(K(e,["Library name","Month","Loans"])))}));var e}}];return Object(r.jsxs)(p.a,{container:!0,children:[Object(r.jsx)(At,{children:Object(r.jsx)(D,{titles:i.map((function(t){return t.title}))})}),Object(r.jsxs)(Mt,{children:[Object(r.jsx)(O,{siteTitle:"Barnet Libraries",subTitle:"Open data"}),Object(r.jsx)(E,{children:a.Children.toArray(i.map((function(t,e){var a=t.title,c=t.component;return Object(r.jsx)("section",{id:w(a),children:Object(r.jsx)(W,{children:n.length>0?c({title:a}):null})})})))})]})]})},Nt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,172)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),r(t),a(t),c(t),i(t)}))},Ft=n(79),Dt=Object(Ft.a)({});o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsxs)(u.a,{theme:Dt,children:[Object(r.jsx)(s.a,{}),Object(r.jsx)(Ct,{})]})}),document.querySelector("#root")),Nt()}},[[120,1,2]]]);
//# sourceMappingURL=main.3b657c0f.chunk.js.map